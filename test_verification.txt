
> schach9x9@1.0.0 test
> NODE_OPTIONS=--experimental-vm-modules jest --coverage

  console.log
    [INFO] 13:10:44.286 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

(node:40989) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/gameEngine.rules.test.js
  Game Engine Rules
    Check Detection
      ✓ should detect simple check from Rook (16 ms)
      ✓ should NOT detect check if blocked (2 ms)
      ✓ should detect Knight check (2 ms)
    Checkmate Detection
      ✓ should detect Back Rank Mate with two Rooks (7 ms)
      ✓ should NOT be checkmate if piece can block the check (5 ms)
      ✕ should detect checkmate with a Queen and Rook (12 ms)
      ✓ should NOT be checkmate if king can move to a safe square (6 ms)
      ✓ should NOT be checkmate if a piece can capture the checking piece (7 ms)
    Castling
      ✓ should allow kingside castling when conditions are met (6 ms)
      ✓ should NOT allow castling if path is blocked (5 ms)
      ✓ should NOT allow castling if king passes through check (1 ms)
    En Passant
      ✓ should allow en passant capture after double pawn push (7 ms)

  ● Game Engine Rules › Checkmate Detection › should detect checkmate with a Queen and Rook

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      102 |
      103 |       expect(game.isInCheck('white')).toBe(true);
    > 104 |       expect(game.isCheckmate('white')).toBe(true);
          |                                         ^
      105 |     });
      106 |
      107 |     test('should NOT be checkmate if king can move to a safe square', () => {

      at Object.<anonymous> (tests/gameEngine.rules.test.js:104:41)

  console.log
    [INFO] 13:10:44.369 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.377 Loaded 1 games from storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.381 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.390 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.393 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.397 Game saved: win vs AI-Beginner (2 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.402 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.405 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.408 Game saved: win vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.411 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.412 Game saved: loss vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.415 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

(node:40990) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/sounds.test.js
  SoundManager
    ✓ initial settings are loaded from localStorage or defaults (14 ms)
    ✓ setVolume converts 0‑100 range to 0‑1 internally (2 ms)
    ✓ toggle flips the enabled flag and persists it (2 ms)
    ✓ playMove does not throw when disabled (2 ms)
    ✕ should play capture sound when enabled (69 ms)
    ✓ should play check sound when enabled (2 ms)
    ✓ should play game start sound when enabled (2 ms)
    ✓ should play game over sound when enabled (1 ms)

  ● SoundManager › should play capture sound when enabled

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "osc.frequency.exponentialRampToValueAtTime is not a function"

          92 |     osc.type = 'square';
          93 |     osc.frequency.setValueAtTime(600, this.audioContext.currentTime);
        > 94 |     osc.frequency.exponentialRampToValueAtTime(100, this.audioContext.currentTime + 0.1);
             |                   ^
          95 |
          96 |     gain.gain.setValueAtTime(this.volume * 0.8, this.audioContext.currentTime);
          97 |     gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);

      at SoundManager.exponentialRampToValueAtTime [as playCapture] (sounds.js:94:19)
      at tests/sounds.test.js:83:26
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (tests/sounds.test.js:83:45)
      at Object.<anonymous> (tests/sounds.test.js:83:45)

  console.log
    [INFO] 13:10:44.445 Game saved: draw vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.483 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.499 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.514 Game saved: win vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.540 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.552 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.555 Game saved: win vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.564 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.570 Game saved: loss vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.582 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.594 Game saved: draw vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.602 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.609 Game saved: win vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.616 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.620 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

(node:40986) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    [INFO] 13:10:44.622 Game saved: win vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.624 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

FAIL tests/moveController.test.js
  MoveController
    ✓ should execute a simple move (26 ms)
    ✓ should handle capture (3 ms)
    ✓ should handle promotion (4 ms)
    ✓ should handle undo move (5 ms)
    ✓ should handle castling kingside (3 ms)
    ✓ should handle en passant (5 ms)
    ✓ should record move in history (3 ms)
    ✕ should handle redo move (5 ms)
    ✓ should clear redo stack when new move is made (5 ms)
    ✓ should handle castling queenside (2 ms)
    ✓ should set hasMoved flag on pieces (4 ms)
    ✕ should handle multiple undo operations (14 ms)

  ● MoveController › should handle redo move

    expect(received).not.toBeNull()

    Received: null

      209 |         // Redo the move
      210 |         moveController.redoMove();
    > 211 |         expect(game.board[5][4]).not.toBeNull();
          |                                      ^
      212 |         expect(game.board[6][4]).toBeNull();
      213 |     });
      214 |

      at Object.<anonymous> (tests/moveController.test.js:211:38)

  ● MoveController › should handle multiple undo operations

    expect(received).toBeNull()

    Received: {"color": "white", "hasMoved": undefined, "type": "p"}

      275 |
      276 |         // Should be back to initial state
    > 277 |         expect(game.board[6][4]).toBeNull();  // First move undone
          |                                  ^
      278 |         expect(game.turn).toBe('white');  // Back to white's turn
      279 |     });
      280 | });

      at Object.<anonymous> (tests/moveController.test.js:277:34)

  console.log
    [INFO] 13:10:44.627 Game saved: loss vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.635 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.646 Game saved: draw vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.648 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.653 Game saved: win vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.663 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.665 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.668 Game saved: win vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.670 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.676 Game saved: loss vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.681 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.684 Game saved: draw vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.690 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.695 Game saved: win vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.699 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.701 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.705 Game saved: win vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.707 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.711 Game saved: loss vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.713 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.715 Game saved: draw vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.719 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.720 Game saved: win vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.724 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.726 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.728 Game saved: win vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.730 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.735 Game saved: loss vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.739 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.742 Game saved: draw vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.744 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

(node:40987) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/effects.test.js
  ParticleSystem
    spawn particles
      ✓ should spawn particles (77 ms)
      ✓ should create more particles for CAPTURE than MOVE (18 ms)
      ✓ should start animation when spawning particles (8 ms)
      ✓ should use default color when not specified (3 ms)
      ✓ should create particles with different types (23 ms)
      ✓ should handle unknown particle type (6 ms)
      ✓ should append particles to container (3 ms)
    particle update logic
      ✓ should remove particles after life expires (24 ms)
      ✓ should update particle positions (25 ms)
      ✓ should apply gravity to particles (26 ms)
      ✓ should decrease particle life over time (21 ms)
    animation lifecycle
      ✕ should handle empty particle array (19 ms)
      ✓ should stop animation when no particles remain (1 ms)
      ✓ should not start multiple animations when already animating (3 ms)
      ✓ should continue animating when particles exist (22 ms)
    particle rendering
      ✕ should set particle position styles (1 ms)
      ✕ should set CAPTURE particles with box shadow (1 ms)
      ✕ should remove particle element when life expires (1 ms)

  ● ParticleSystem › animation lifecycle › should handle empty particle array

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: undefined

      168 |
      169 |             expect(newParticleSystem.particles.length).toBe(0);
    > 170 |             expect(newParticleSystem.animating).toBe(false);
          |                                                 ^
      171 |         });
      172 |
      173 |         test('should stop animation when no particles remain', () => {

      at Object.<anonymous> (tests/effects.test.js:170:49)

  ● ParticleSystem › particle rendering › should set particle position styles

    TypeError: Failed to execute 'appendChild' on 'Node': parameter 1 is not of type 'Node'.

      36 |             }
      37 |
    > 38 |             this.container.appendChild(p);
         |                            ^
      39 |
      40 |             this.particles.push({
      41 |                 el: p,

      at Object.exports.convert (node_modules/jsdom/lib/jsdom/living/generated/Node.js:25:9)
      at HTMLBodyElement.appendChild (node_modules/jsdom/lib/jsdom/living/generated/Node.js:404:26)
      at ParticleSystem.appendChild [as spawn] (effects.js:38:28)
      at Object.<anonymous> (tests/effects.test.js:218:31)

  ● ParticleSystem › particle rendering › should set CAPTURE particles with box shadow

    TypeError: Failed to execute 'appendChild' on 'Node': parameter 1 is not of type 'Node'.

      36 |             }
      37 |
    > 38 |             this.container.appendChild(p);
         |                            ^
      39 |
      40 |             this.particles.push({
      41 |                 el: p,

      at Object.exports.convert (node_modules/jsdom/lib/jsdom/living/generated/Node.js:25:9)
      at HTMLBodyElement.appendChild (node_modules/jsdom/lib/jsdom/living/generated/Node.js:404:26)
      at ParticleSystem.appendChild [as spawn] (effects.js:38:28)
      at Object.<anonymous> (tests/effects.test.js:235:31)

  ● ParticleSystem › particle rendering › should remove particle element when life expires

    TypeError: Failed to execute 'appendChild' on 'Node': parameter 1 is not of type 'Node'.

      36 |             }
      37 |
    > 38 |             this.container.appendChild(p);
         |                            ^
      39 |
      40 |             this.particles.push({
      41 |                 el: p,

      at Object.exports.convert (node_modules/jsdom/lib/jsdom/living/generated/Node.js:25:9)
      at HTMLBodyElement.appendChild (node_modules/jsdom/lib/jsdom/living/generated/Node.js:404:26)
      at ParticleSystem.appendChild [as spawn] (effects.js:38:28)
      at Object.<anonymous> (tests/effects.test.js:252:31)

  console.log
    [INFO] 13:10:44.746 Game saved: win vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.758 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.760 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.769 Game saved: win vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.775 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.779 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.782 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.784 Game saved: win vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.789 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.792 Game saved: loss vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.796 Exported 2 games

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.800 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.804 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.807 Game saved: win vs Original (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.813 Imported 1 new games (merged)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.815 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.836 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.838 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.841 Game saved: win vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.842 Imported 1 games (replaced)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.846 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.850 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [ERROR] 13:10:44.853 Error importing games: SyntaxError: Unexpected token i in JSON at position 0
        at JSON.parse (<anonymous>)
        at StatisticsManager.parse [as importGames] (/home/tobber/.gemini/antigravity/scratch/schach/statisticsManager.js:183:37)
        at Object.<anonymous> (/home/tobber/.gemini/antigravity/scratch/schach/tests/statisticsManager.test.js:223:37)
        at Promise.then.completed (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/home/tobber/.gemini/antigravity/scratch/schach/node_modules/jest-runner/build/testWorker.js:106:12)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.910 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.913 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.918 Game saved: win vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.921 Imported 0 new games (merged)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.922 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.926 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.928 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.931 Game saved: win vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [WARN] 13:10:44.936 clearHistory called without confirmation

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.941 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.947 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.851 [AI Worker] TT Hit Rate: 0.0% (0/14), Nodes: 14

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.954 Game saved: win vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.959 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.964 Game saved: loss vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.967 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.973 Game history cleared

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.978 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.986 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.994 [AI Worker] TT Hit Rate: 0.0% (0/26), Nodes: 12

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:44.995 Game saved: win vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:44.998 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.005 Game saved: win vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:45.012 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.013 Game saved: loss vs Unknown (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.022 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:45.025 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.030 Game saved: win vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:45.071 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.078 Game saved: win vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.073 [AI Worker] TT Hit Rate: 3.6% (4/112), Nodes: 80

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:45.082 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.090 Game saved: loss vs AI-Easy (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:45.091 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.102 Game saved: win vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [DEBUG] 13:10:45.112 Game history saved to storage

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.113 Game saved: loss vs AI-Hard (0 moves)

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.130 StatisticsManager initialized

      at Logger.log [as _log] (logger.js:70:13)

(node:40993) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS tests/arrows.test.js
  ArrowRenderer
    Initialization
      ✓ should create SVG layer on initialization (98 ms)
      ✓ should calculate cell size from board cells (35 ms)
      ✓ should create arrowhead markers for each quality (74 ms)
      ✓ should position SVG layer absolutely (46 ms)
    Drawing Arrows
      ✓ should draw arrow from one square to another (32 ms)
      ✓ should draw arrows with correct color based on quality (36 ms)
      ✓ should use correct marker-end for arrow quality (23 ms)
      ✓ should default to gold quality if not specified (47 ms)
    Clearing Arrows
      ✓ should clear all arrows from SVG layer (26 ms)
      ✓ should not throw error when clearing empty arrows (35 ms)
    Highlight Move
      ✓ should clear previous arrows and draw new one (26 ms)
      ✓ should store last arrow for redraw (21 ms)
    Redraw
      ✓ should redraw last arrow after cell size update (39 ms)
      ✓ should not throw error when redrawing with no last arrow (39 ms)
    Destroy
      ✓ should remove SVG layer from DOM (33 ms)
      ✓ should not throw error when destroying already destroyed renderer (56 ms)
    Coordinate Calculations
      ✓ should calculate correct center positions for arrows (56 ms)

PASS tests/gameEngine.additional.test.js
  Game Engine Additional Tests
    ✓ white pawn forward move and double step from starting row (35 ms)
    ✓ black pawn forward move and double step from starting row (5 ms)
    ✓ pawn captures diagonally when opponent pieces present (6 ms)
    ✓ archbishop (bishop + knight) combines moves correctly (30 ms)
    ✓ chancellor (rook + knight) combines moves correctly (15 ms)

(node:40992) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS tests/statisticsManager.test.js
  StatisticsManager
    Initialization
      ✓ should initialize with empty data (89 ms)
      ✓ should load existing data from localStorage (20 ms)
    saveGame
      ✓ should save a game and update statistics (13 ms)
      ✓ should calculate win rate correctly (81 ms)
      ✓ should persist data to localStorage (48 ms)
    getGameHistory
      ✓ should return all games by default (85 ms)
      ✓ should filter by result (47 ms)
      ✓ should filter by opponent (35 ms)
      ✓ should limit results (24 ms)
      ✓ should sort by date (newest first) (28 ms)
    getGameById
      ✓ should return game by ID (16 ms)
      ✓ should return null for non-existent ID (4 ms)
    exportGames
      ✓ should export games as JSON string (20 ms)
    importGames
      ✓ should import games (merge mode) (37 ms)
      ✓ should import games (replace mode) (13 ms)
      ✓ should handle invalid import data (60 ms)
      ✓ should avoid duplicate IDs when merging (15 ms)
    clearHistory
      ✓ should not clear without confirmation (15 ms)
      ✓ should clear all history with confirmation (37 ms)
    getRecentStats
      ✓ should get stats for recent games (43 ms)
    getStatsByOpponent
      ✓ should group statistics by opponent (109 ms)
    recalculateStats
      ✓ should recalculate statistics from game history (13 ms)

  console.log
    [INFO] 13:10:45.188 [AI Worker] TT Hit Rate: 1.9% (4/211), Nodes: 99

      at Logger.log [as _log] (logger.js:70:13)

PASS tests/ui.test.js
  UI Module - initBoardUI
    ✓ creates 9x9 cells with correct data attributes (98 ms)
    ✓ adds column and row coordinate labels (32 ms)
    ✓ clicking a cell calls game.handleCellClick with correct coordinates (64 ms)
  UI Module - getPieceSymbol
    ✓ should return correct SVG for white king (6 ms)
    ✓ should return empty string for null piece

  console.log
    [INFO] 13:10:45.216 [AI Worker] TT Hit Rate: 1.7% (4/240), Nodes: 29

      at Logger.log [as _log] (logger.js:70:13)

  console.log
    [INFO] 13:10:45.313 [AI Worker] TT Hit Rate: 0.7% (4/605), Nodes: 365

      at Logger.log [as _log] (logger.js:70:13)

PASS tests/gameEngine.pieces.test.js
  getValidMoves - Pawn
    ✓ should allow white pawn to move forward one square (20 ms)
    ✓ should allow black pawn to move forward one square (1 ms)
    ✓ should allow pawn to capture diagonally (2 ms)
  getValidMoves - Rook
    ✓ should allow rook to move in straight lines (2 ms)

PASS tests/aiEngine.test.js
  AI Engine
    evaluatePosition
      ✓ should return 0 for empty board (5 ms)
      ✓ should value material correctly (2 ms)
      ✓ should favor material advantage (3 ms)
    getAllLegalMoves
      ✓ should find moves for a single piece (3 ms)
    getBestMove
      ✓ should find a simple capture (122 ms)
      ✓ should avoid immediate capture (40 ms)
    Zobrist Hashing
      ✓ should produce same hash for same position (1 ms)
      ✓ should produce different hash for different position (1 ms)
      ✓ should produce different hash for different turn
    Transposition Table (LRU)
      ✓ should evict oldest entry when full (3 ms)
      ✓ should update MRU on access (1 ms)
    Advanced AI Scenarios
      ✓ should find Mate in 1 (78 ms)
      ✓ should avoid Stalemate when winning (113 ms)
      ✓ should use Quiescence Search to see capture chains (23 ms)
    Move Ordering and Optimization
      ✓ should prioritize captures in move ordering (94 ms)
      ✓ should evaluate center control (2 ms)
      ✓ should handle positions with no legal moves (1 ms)

PASS tests/gameEngine.test.js
  getValidMoves
    ✓ should return valid knight moves in the center (9 ms)
    ✓ should not allow moves off the board (1 ms)

PASS tests/logger.test.js
  Logger
    basic logging
      ✓ should log info messages (6 ms)
      ✓ should log debug messages (1 ms)
      ✓ should log warning messages (1 ms)
      ✓ should log error messages (1 ms)
      ✓ should pass multiple arguments to log methods (2 ms)
    log level settings
      ✓ should respect log level settings (1 ms)
      ✓ should log at ERROR level only errors (1 ms)
      ✓ should log at WARN level warnings and errors (5 ms)
      ✓ should log at INFO level info, warnings, and errors (2 ms)
      ✓ should log at DEBUG level all messages (1 ms)
    enable/disable logging
      ✓ should enable and disable logging (1 ms)
      ✓ should not log when disabled regardless of level (2 ms)
    context logger
      ✓ should create context logger (1 ms)
      ✓ should create context logger for all log levels (1 ms)
      ✓ should pass additional arguments through context logger (3 ms)
      ✓ should respect enabled/disabled state in context logger (1 ms)
      ✓ should respect log level in context logger (1 ms)
    timestamp formatting
      ✓ should format timestamps correctly (1 ms)
      ✓ should include timestamp in all log levels (1 ms)
    localStorage integration
      ✓ should handle missing localStorage gracefully (1 ms)
      ✓ should persist log level setting
      ✓ should persist enabled setting (1 ms)

PASS tests/utils.test.js
  Utils
    debounce
      ✓ should delay function execution (15 ms)
      ✓ should cancel previous call if called again within delay (2 ms)
      ✓ should pass arguments to debounced function (3 ms)
      ✓ should use default delay of 150ms when not specified (1 ms)
      ✓ should handle multiple rapid calls correctly (1 ms)
      ✓ should preserve context when calling debounced function (2 ms)
    deepCopy
      ✓ should deep copy simple objects (1 ms)
      ✓ should deep copy nested objects
      ✓ should deep copy arrays
      ✓ should handle null and undefined values (1 ms)
      ✓ should deep copy objects with various data types (5 ms)
      ✓ should handle empty objects and arrays (1 ms)
      ✓ should deep copy multi-level nested structures (1 ms)
      ✓ should handle arrays of objects
    coordToAlgebraic
      ✓ should convert coordinates to algebraic notation
      ✓ should handle all files (columns a-i) (2 ms)
      ✓ should handle all ranks (rows 1-9) (2 ms)
      ✓ should handle corner coordinates (1 ms)
      ✓ should handle center coordinates
      ✓ should convert various middle positions (1 ms)

PASS tests/gameEngine.classic.test.js
  Game Engine - Classic Mode
    ✓ should initialize in PLAY phase (4 ms)
    ✓ should setup pawns correctly (11 ms)
    ✓ should setup pieces correctly (R N B Q K Q B N R) (3 ms)
    ✓ should have empty rows in between (7 ms)

(node:40991) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS tests/tutorial.test.js
  Tutorial
    Initialization
      ✓ should initialize with first step (276 ms)
      ✓ should create tutorial steps (177 ms)
      ✓ should have steps with title and content (86 ms)
    Step Creation
      ✓ should create Archbishop demo step (71 ms)
      ✓ should create Chancellor demo step (76 ms)
      ✓ should create corridor demo (53 ms)
      ✓ should create shop demo (92 ms)
    Move Grid Creation
      ✓ should create move grid for Archbishop (93 ms)
      ✓ should create move grid for Chancellor (83 ms)
      ✓ should include piece SVG in grid (46 ms)
    Move Type Detection
      ✓ should detect bishop moves for Archbishop (82 ms)
      ✓ should detect rook moves for Chancellor (94 ms)
      ✓ should return empty string for invalid moves (70 ms)
    Navigation
      ✓ should navigate to next step (49 ms)
      ✓ should close on last step next (28 ms)
      ✓ should navigate to previous step (59 ms)
      ✓ should not go before first step (28 ms)
    Show and Hide
      ✓ should show tutorial overlay (27 ms)
      ✓ should hide tutorial overlay (23 ms)
      ✓ should NOT reset to first step when closed (only on show) (21 ms)
    Update Step Display
      ✓ should update active step class when step changes (16 ms)
      ✓ should update step indicator (21 ms)
      ✓ should disable prev button on first step (16 ms)
      ✓ should change next button text on last step (23 ms)
    Piece Moves Logic
      ✓ should return moves for Archbishop (12 ms)
      ✓ should return moves for Chancellor (13 ms)
      ✓ should return default moves (Chancellor) for unknown piece type (18 ms)

----------------------|---------|----------|---------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------
File                  | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                            
----------------------|---------|----------|---------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------
All files             |   50.05 |     42.5 |   58.66 |   50.35 |                                                                                                                                                              
 aiEngine.js          |    76.8 |    66.85 |      75 |   76.35 | 53-57,96-134,211,235-236,250-258,269,280,293-340,351,362,368-387,390-396,459-462,472-477,496,529,549-573,590-596,711,743-747,805-814,931,997                 
 arrows.js            |   98.61 |    71.42 |     100 |   98.59 | 20                                                                                                                                                           
 chess-pieces.js      |   36.36 |        0 |       0 |   36.36 | 163-173                                                                                                                                                      
 config.js            |     100 |      100 |     100 |     100 |                                                                                                                                                              
 effects.js           |   89.36 |    93.33 |      60 |   93.02 | 67-69                                                                                                                                                        
 gameEngine.js        |   90.06 |    79.29 |     100 |   92.16 | 92-96,271-272,287-288,311-312,362-375,461,486                                                                                                                
 logger.js            |     100 |     62.5 |     100 |     100 | 29-53                                                                                                                                                        
 moveController.js    |   35.32 |    38.15 |   51.21 |   34.74 | 18-62,68,179-181,196-209,244-264,273-280,288-308,310-323,325,337,341,348,366-385,421,442-443,447-448,454-467,473-486,490-503,529,538,549-565,571-580,600-875 
 sounds.js            |   62.28 |     40.9 |   82.35 |   64.22 | 22-27,39,56-57,62-78,96-100,176-190,202-208                                                                                                                  
 statisticsManager.js |   96.03 |       85 |     100 |   95.55 | 40,64,186,304                                                                                                                                                
 tutorial.js          |   88.37 |    79.62 |   81.81 |   91.13 | 278-284                                                                                                                                                      
 ui.js                |     7.3 |     3.11 |    3.57 |    6.93 | 14-133,159-206,213-217,221-236,241,245-264,272-286,294-299,371-1586                                                                                          
 utils.js             |     100 |      100 |     100 |     100 |                                                                                                                                                              
----------------------|---------|----------|---------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------
Test Suites: 4 failed, 11 passed, 15 total
Tests:       8 failed, 187 passed, 195 total
Snapshots:   0 total
Time:        3.948 s
Ran all test suites.
